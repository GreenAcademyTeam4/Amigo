<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>
<body>

<div>
    <form action="/board/delete/{{board.id}}" method="post">
        <button type="submit">ê²Œì‹œê¸€ ì‚­ì œ</button>
    </form>
</div>

<div>
    <form action="/board/update/{{board.id}}" method="get">
        <button type="submit">ê²Œì‹œê¸€ ìˆ˜ì •í•˜ê¸°</button>
    </form>
</div>

<div class="container mt-5">
    <input type="hidden" name="" id="" value="">

    <h1>{{board.title}}</h1>
    <p><strong>ì‘ì„±ì ID:</strong> {{board.userId}}</p>
    <p><strong>í•™êµ ID:</strong> {{board.schoolId}}</p>
    <p><strong>ë‹‰ë„¤ì„ :</strong> {{board.nickname}}</p>

    <p><strong>ë‚´ìš©:</strong> {{board.contentLocation}} </p>

    <p><strong>ì¡°íšŒìˆ˜:</strong> {{board.viewCount}}</p>
    <p><strong>ì¢‹ì•„ìš”:</strong> {{board.likes}}</p>
    <p><strong>ì‘ì„±ì¼ì:</strong> {{board.createdAtFormat}}</p>
    <a href="/board/list" class="btn btn-primary mt-3">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>


    <hr>

    <!-- ëŒ“ê¸€ ëª©ë¡ -->
    <div class="comments mt-5">
        <h3>ëŒ“ê¸€ ëª©ë¡</h3>
        {{#comment}}
            <div class="comment" id="comment-{{id}}">
                <p><strong>ì‘ì„±ì :</strong> {{nickname}}</p>
                <p id="content-{{id}}">{{content}}</p>
                <p><small>ì‘ì„±ì¼ì: {{createdAtFormat}}</small></p>

                    <button onclick="deleteComment({{id}})" class="btn btn-danger">ğŸ—‘</button>

                <button onclick="showEditForm({{id}})" class="btn btn-link">ìˆ˜ì •</button>

                <!-- ëŒ“ê¸€ ìˆ˜ì • í¼ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ ì²˜ë¦¬) -->
                <div id="edit-form-{{id}}" style="display: none; margin-top: 10px;">
                    <textarea id="edit-content-{{id}}" rows="3" class="form-control">{{content}}</textarea>
                    <button onclick="updateComment({{id}})" class="btn btn-success mt-2">ìˆ˜ì • ì™„ë£Œ</button>
                </div>
            </div>
            <hr>
        {{/comment}}
        {{^comment}}
            <p>ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {{/comment}}
    </div>

    <!-- ëŒ“ê¸€ ì‘ì„± í¼ -->
    <div class="comment-form mt-5">
        <h3>ëŒ“ê¸€ ë‹¬ê¸°</h3>
        <form action="/board/comment" method="post">
            <input type="hidden" name="boardId" value="{{board.id}}">
            <div class="form-group">
                <label for="commentContent">ëŒ“ê¸€ ë‚´ìš©</label>
                <textarea class="form-control" id="commentContent" name="content" rows="3" required></textarea>
            </div>
            <button type="submit" class="btn btn-success mt-3">ëŒ“ê¸€ ë“±ë¡</button>
        </form>
    </div>


</div>

<script>
    <!-- ìˆ˜ì • ë²„íŠ¼ í´ë¦­ì‹œ í•¨ìˆ˜ ì‹œì‘ (ëŒ“ê¸€Id, ) -->
    function showEditForm(commentId) {
        const editForm = document.getElementById(`edit-form-${commentId}`);
        const contentElement = document.getElementById(`content-${commentId}`);

        if (editForm && contentElement) {
            editForm.style.display = 'block';
            contentElement.style.display = 'none';
        } else {
            console.error("Edit form or content element not found for comment ID:", commentId);
        }
    }

    function updateComment(commentId) {
        const updatedContent = document.getElementById(`edit-content-${commentId}`).value;

        fetch(`/board/reply/update/${commentId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ content: updatedContent })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('ëŒ“ê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                document.getElementById(`content-${commentId}`).innerText = updatedContent;
                document.getElementById(`edit-form-${commentId}`).style.display = 'none';
                document.getElementById(`content-${commentId}`).style.display = 'block';
            } else {
                alert('ëŒ“ê¸€ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        });
    }


    function deleteComment(commentId) {
        fetch(`/board/reply/delete/${commentId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('ëŒ“ê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                const commentElement = document.getElementById(`comment-${commentId}`);
                if (commentElement) {
                    commentElement.remove();
                }
            } else {
                alert('ëŒ“ê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        });
    }

</script>


</body>
</html>